<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>動詞辞書ビューア</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Hiragino Sans', 'Meiryo', 'Yu Gothic', sans-serif;
      background-color: #f7f7f7;
      color: #000;
      line-height: 1.5;
    }

    .verb-card {
      background-color: #fff;
      padding: 20px 25px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 3px 5px -1px rgba(0, 0, 0, 0.08),
        0 1px 3px -1px rgba(0, 0, 0, 0.04);
    }

    .filter-list {
      list-style: none;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      padding: 0;
      margin: 0;
    }

    .filter-list a {
      display: inline-block;
      padding: 3px 6px;
      border-radius: 4px;
      color: #333;
      text-decoration: none;
      transition: background-color 0.2s;
      font-size: 0.9em;
    }

    .filter-list a:hover {
      background-color: #eef;
    }

    .filter-list a.active {
      background-color: #007bff;
      color: white;
      font-weight: 700;
    }

    #current-filter {
      backdrop-filter: blur(6px);
      border-bottom: 1px solid #ddd;
    }

    #prefix-explanation {
      backdrop-filter: blur(6px);
      border-bottom: 1px solid #cbd5e1;
    }
  </style>
</head>

<body class="p-4 sm:p-6 lg:p-8">
  <header class="text-center mb-10">
    <h1 class="text-3xl font-bold text-gray-800">ドイツ語動詞辞書</h1>
    <p class="text-gray-500 mt-2">接頭辞と基幹に基づいたフィルタリングビューア</p>
  </header>

  <div id="app-container" class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    <!-- サイドバー -->
    <aside
      class="sidebar lg:col-span-1 bg-white p-6 rounded-lg shadow-lg border-r border-gray-200">
      <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-gray-700">
        フィルタリング
      </h2>

      <div class="mb-6">
        <h3 class="text-lg font-medium mb-2 text-gray-600">接頭辞 (Prefix)</h3>
        <ul id="prefix-list" class="filter-list text-sm"></ul>
      </div>

      <div>
        <h3 class="text-lg font-medium mb-2 text-gray-600">基幹 (Stem)</h3>
        <ul id="stem-list" class="filter-list text-sm"></ul>
      </div>
    </aside>

    <!-- メイン -->
    <main id="main-content" class="lg:col-span-3">
      <!-- Stickyヘッダー -->
      <div
        id="current-filter"
        class="sticky top-0 z-30 bg-white shadow-sm text-center py-3 mb-2 hidden">
      </div>

      <!-- Sticky接頭辞説明 -->
      <div
        id="prefix-explanation"
        class="sticky top-[72px] z-20 bg-blue-50 border-b border-blue-200 text-center py-2 text-gray-800 text-lg italic hidden">
      </div>

      <!-- メイン内容 -->
      <h2 class="text-2xl font-semibold mb-6 text-gray-800 text-center">
        すべての単語
      </h2>

      <div id="verb-details" class="verb-grid">
        <p class="text-center text-gray-500 mt-10 col-span-full">
          データを読み込み中です...
        </p>
      </div>
    </main>
  </div>

  <script>
    const JSON_URL =
      'https://raw.githubusercontent.com/SallyYamamoto/Prefix_German/refs/heads/main/verbs.json';
    let allData = [];

    const prefixExplanations = {
      be: 'be- は動詞を他動詞化し、対象への働きかけを表す。例: befragen（質問する）、bemalen（塗る）。',
      ent: 'ent- は『離れる』『取り除く』『反対の動作』を意味する。例: entkommen（逃れる）、entfernen（取り除く）。',
      ver: 'ver- は『間違い・変化・消滅』などを表す。例: verlieren（失う）、verändern（変化させる）。',
      zer: 'zer- は『分解・破壊・分裂』を意味する。例: zerreißen（引き裂く）。',
      auf: 'auf- は『上昇・開始・開放』を意味する。例: aufstehen（起きる）、aufmachen（開ける）。',
      an: 'an- は『接近・開始・関与』を表す。例: anfangen（始める）、anrufen（電話する）。',
      aus: 'aus- は『外への動き・完了・結果』を表す。例: ausgehen（出かける）、ausruhen（休む）。',
      nach: 'nach- は『後に続く・模倣・再現』を意味する。例: nachmachen（まねる）、nachfragen（問い合わせる）。',
      mit: 'mit- は『共に・一緒に』を意味する。例: mitnehmen（持って行く）、mitarbeiten（協力する）。',
      unter:
        'unter- は『下・補助・不足・秘密裏』など多義的。例: unterhalten（楽しませる）、unterschreiben（署名する）。',
      über:
        'über- は『越えて・過度・支配』を意味する。例: übertreiben（誇張する）、übernehmen（引き受ける）。',
      ab: 'ab- は『分離・除去・開始・完了』を意味する。例: abfahren（出発する）、abnehmen（減る）。',
      er: 'er- は『結果・達成・開始・誕生』を表す。例: erreichen（到達する）、erkennen（気づく）。',
      vor: 'vor- は『前・予防・優先』を表す。例: vorlesen（朗読する）、vorbereiten（準備する）。',
      weg: 'weg- は『離れる・消える』を表す。例: weggehen（立ち去る）、wegwerfen（捨てる）。',
      bei: 'bei- は『そばで・関与・助長』を意味する。例: beistehen（助ける）、beibringen（教える）。'
    };

    async function fetchData() {
      try {
        const response = await fetch(JSON_URL);
        if (!response.ok) throw new Error(`HTTPエラー: ${response.status}`);
        const data = await response.json();
        allData = data.map((item) => ({
          word: item.単語,
          meaning: item.意味,
          stem: item.基幹,
          prefix: item.接頭辞,
          englishTranslation: item.英訳,
          prefixMeaning: item.接頭辞基本意味,
          nuance: item.語感,
          syntax: item.構文,
          separability: item.分離性,
          conjugation: item.活用,
          example1: item.例文1,
          japaneseTranslation1: item.日本語訳1,
          example2: item.例文2,
          japaneseTranslation2: item.日本語訳2,
          derivatives: item.派生語,
          correspondingEnglish: item.対応英単語
        }));
        initializePage();
      } catch (err) {
        console.error('Error:', err);
      }
    }

    function initializePage() {
      const prefixes = [...new Set(allData.map((i) => i.prefix))].filter(Boolean).sort();
      const stems = [...new Set(allData.map((i) => i.stem))].filter(Boolean).sort();
      renderPrefixList(prefixes);
      renderStemList(stems);
      renderVerbDetails(allData);
    }

    function renderPrefixList(prefixes) {
      const el = document.getElementById('prefix-list');
      el.innerHTML = '';
      const common = ['ab', 'an', 'auf', 'aus', 'be', 'bei', 'ent', 'er', 'ver', 'zer', 'nach', 'mit', 'über', 'unter', 'vor', 'weg'];
      const freq = prefixes.filter((p) => common.includes(p));
      const other = prefixes.filter((p) => !common.includes(p));
      const section = (title, items, color) => {
        const div = document.createElement('div');
        div.classList.add('mb-3');
        div.innerHTML = `
          <div class="flex items-center mb-1">
            <span class="inline-block ${color} font-semibold px-2 py-0.5 rounded">${title}</span>
          </div>
        `;
        const ul = document.createElement('ul');
        ul.classList.add('filter-list');
        items.forEach((p) => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="#" data-filter-value="${p}" data-filter-type="prefix">${p}</a>`;
          li.querySelector('a').addEventListener('click', (e) => filterData(e, 'prefix'));
          ul.appendChild(li);
        });
        div.appendChild(ul);
        return div;
      };
      const all = document.createElement('li');
      all.classList.add('all-item');
      all.innerHTML = `<a href="#" data-filter-value="all" data-filter-type="prefix" class="active">全ての接頭辞</a>`;
      all.querySelector('a').addEventListener('click', (e) => filterData(e, 'prefix'));
      el.appendChild(all);
      el.appendChild(section('頻出', freq, 'bg-blue-100 text-blue-700'));
      el.appendChild(section('その他', other, 'bg-gray-100 text-gray-700'));
    }

    function renderStemList(stems) {
      const el = document.getElementById('stem-list');
      el.innerHTML = '';
      const all = document.createElement('li');
      all.classList.add('all-item');
      all.innerHTML = `<a href="#" data-filter-value="all" data-filter-type="stem" class="active">全ての基幹</a>`;
      all.querySelector('a').addEventListener('click', (e) => filterData(e, 'stem'));
      el.appendChild(all);
      const grouped = {};
      stems.forEach((s) => {
        const f = s[0].toUpperCase();
        if (!grouped[f]) grouped[f] = [];
        grouped[f].push(s);
      });
      Object.keys(grouped)
        .sort()
        .forEach((l) => {
          const div = document.createElement('div');
          div.classList.add('mb-3');
          div.innerHTML = `
            <div class="flex items-center mb-1">
              <span class="inline-block bg-blue-100 text-blue-700 font-semibold px-2 py-0.5 rounded">${l}</span>
            </div>`;
          const ul = document.createElement('ul');
          ul.classList.add('filter-list');
          grouped[l].forEach((s) => {
            const li = document.createElement('li');
            li.innerHTML = `<a href="#" data-filter-value="${s}" data-filter-type="stem">${s}</a>`;
            li.querySelector('a').addEventListener('click', (e) => filterData(e, 'stem'));
            ul.appendChild(li);
          });
          div.appendChild(ul);
          el.appendChild(div);
        });
    }

    function filterData(e, type) {
      e.preventDefault();
      const val = e.target.getAttribute('data-filter-value');
      const cf = document.getElementById('current-filter');
      const pe = document.getElementById('prefix-explanation');
      let filtered = [];
      if (val === 'all') {
        filtered = allData;
        cf.classList.add('hidden');
        pe.classList.add('hidden');
      } else if (type === 'prefix') {
        filtered = allData.filter((i) => i.prefix === val);
        cf.innerHTML = `<span class="text-5xl font-extrabold text-blue-700 tracking-wide">${val}-</span>`;
        cf.classList.remove('hidden');
        if (prefixExplanations[val]) {
          pe.innerHTML = prefixExplanations[val];
          pe.classList.remove('hidden');
        } else pe.classList.add('hidden');
      } else if (type === 'stem') {
        filtered = allData.filter((i) => i.stem === val);
        cf.innerHTML = `<span class="text-5xl font-extrabold text-green-700 tracking-wide">-${val}</span>`;
        cf.classList.remove('hidden');
        pe.classList.add('hidden');
      }
      renderVerbDetails(filtered);
      document.querySelectorAll('.filter-list a').forEach((a) => a.classList.remove('active'));
      e.target.classList.add('active');
    }

    function renderVerbDetails(data) {
      const el = document.getElementById('verb-details');
      el.innerHTML = '';
      if (!data.length) {
        el.innerHTML = `<p class="text-center text-gray-500 mt-10 col-span-full">該当する単語は見つかりませんでした。</p>`;
        return;
      }
      data.forEach((item) => {
        const div = document.createElement('div');
        div.classList.add('verb-card');
        div.innerHTML = `
          <div class="card-header mb-2">
            <h3 class="text-2xl font-semibold">${item.word}</h3>
            <div class="etymology text-blue-500 italic">${item.prefix || '---'} + ${item.stem || '---'}</div>
          </div>
          <div class="meaning-jp text-lg font-bold mb-1">${item.meaning}</div>
          <div class="meaning-en text-sm italic text-gray-600 mb-3">(${item.englishTranslation || '---'})</div>
        `;
        el.appendChild(div);
      });
    }

    fetchData();
  </script>
</body>
</html>
